-- ===========================================
-- 2025年神奈川县社会保险费等级表
-- 用于健康保险、厚生年金保险的计算
-- ===========================================

-- 创建保险费等级表
CREATE TABLE premium_bracket (
    id BIGSERIAL PRIMARY KEY,
    grade VARCHAR(20) NOT NULL UNIQUE,
    std_rem INTEGER NOT NULL,
    min_amount INTEGER NOT NULL,
    max_amount INTEGER NOT NULL,
    health_no_care NUMERIC(10, 2) NOT NULL,
    health_care NUMERIC(10, 2) NOT NULL,
    pension NUMERIC(10, 2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 添加表注释
COMMENT ON TABLE premium_bracket IS '2025年神奈川县社会保险费等级表，用于健康保险、厚生年金保险的计算';
COMMENT ON COLUMN premium_bracket.grade IS '等级';
COMMENT ON COLUMN premium_bracket.std_rem IS '标准报酬';
COMMENT ON COLUMN premium_bracket.min_amount IS '最小值';
COMMENT ON COLUMN premium_bracket.max_amount IS '最大值（999999999表示无上限）';
COMMENT ON COLUMN premium_bracket.health_no_care IS '健康保险费（无护理）';
COMMENT ON COLUMN premium_bracket.health_care IS '健康保险费（有护理）';
COMMENT ON COLUMN premium_bracket.pension IS '厚生年金保险费（0表示不适用）';

-- 创建索引
CREATE INDEX idx_premium_bracket_grade ON premium_bracket(grade);
CREATE INDEX idx_premium_bracket_min_max ON premium_bracket(min_amount, max_amount);

-- 插入2025年神奈川县社会保险费等级表数据
INSERT INTO premium_bracket (grade, std_rem, min_amount, max_amount, health_no_care, health_care, pension) VALUES
('1', 58000, 0, 63000, 5753.60, 6675.80, 0),
('2', 68000, 63000, 73000, 6745.60, 7826.80, 0),
('3', 78000, 73000, 83000, 7737.60, 8977.80, 0),
('4(1)', 88000, 83000, 93000, 8729.60, 10128.80, 16104.00),
('5(2)', 98000, 93000, 101000, 9721.60, 11279.80, 17934.00),
('6(3)', 104000, 101000, 107000, 10316.80, 11970.40, 19032.00),
('7(4)', 110000, 107000, 114000, 10912.00, 12661.00, 20130.00),
('8(5)', 118000, 114000, 122000, 11705.60, 13581.80, 21594.00),
('9(6)', 126000, 122000, 130000, 12499.20, 14502.60, 23058.00),
('10(7)', 134000, 130000, 138000, 13292.80, 15423.40, 24522.00),
('11(8)', 142000, 138000, 146000, 14086.40, 16344.20, 25986.00),
('12(9)', 150000, 146000, 155000, 14880.00, 17265.00, 27450.00),
('13(10)', 160000, 155000, 165000, 15872.00, 18416.00, 29280.00),
('14(11)', 170000, 165000, 175000, 16864.00, 19567.00, 31110.00),
('15(12)', 180000, 175000, 185000, 17856.00, 20718.00, 32940.00),
('16(13)', 190000, 185000, 195000, 18848.00, 21869.00, 34770.00),
('17(14)', 200000, 195000, 210000, 19840.00, 23020.00, 36600.00),
('18(15)', 220000, 210000, 230000, 21824.00, 25322.00, 40260.00),
('19(16)', 240000, 230000, 250000, 23808.00, 27624.00, 43920.00),
('20(17)', 260000, 250000, 270000, 25792.00, 29926.00, 47580.00),
('21(18)', 280000, 270000, 290000, 27776.00, 32228.00, 51240.00),
('22(19)', 300000, 290000, 310000, 29760.00, 34530.00, 54900.00),
('23(20)', 320000, 310000, 330000, 31744.00, 36832.00, 58560.00),
('24(21)', 340000, 330000, 350000, 33728.00, 39134.00, 62220.00),
('25(22)', 360000, 350000, 370000, 35712.00, 41436.00, 65880.00),
('26(23)', 380000, 370000, 395000, 37696.00, 43738.00, 69540.00),
('27(24)', 410000, 395000, 425000, 40672.00, 47191.00, 75030.00),
('28(25)', 440000, 425000, 455000, 43648.00, 50644.00, 80520.00),
('29(26)', 470000, 455000, 485000, 46624.00, 54097.00, 86010.00),
('30(27)', 500000, 485000, 515000, 49600.00, 57550.00, 91500.00),
('31(28)', 530000, 515000, 545000, 52576.00, 61003.00, 96990.00),
('32(29)', 560000, 545000, 575000, 55552.00, 64456.00, 102480.00),
('33(30)', 590000, 575000, 605000, 58528.00, 67909.00, 107970.00),
('34(31)', 620000, 605000, 635000, 61504.00, 71362.00, 113460.00),
('35(32)', 650000, 635000, 665000, 64480.00, 74815.00, 118950.00),
('36', 680000, 665000, 695000, 67456.00, 78268.00, 118950.00),
('37', 710000, 695000, 730000, 70432.00, 81721.00, 118950.00),
('38', 750000, 730000, 770000, 74400.00, 86325.00, 118950.00),
('39', 790000, 770000, 810000, 78368.00, 90929.00, 118950.00),
('40', 830000, 810000, 855000, 82336.00, 95533.00, 118950.00),
('41', 880000, 855000, 905000, 87296.00, 101288.00, 118950.00),
('42', 930000, 905000, 955000, 92256.00, 107043.00, 118950.00),
('43', 980000, 955000, 1005000, 97216.00, 112798.00, 118950.00),
('44', 1030000, 1005000, 1055000, 102176.00, 118553.00, 118950.00),
('45', 1090000, 1055000, 1115000, 108128.00, 125459.00, 118950.00),
('46', 1150000, 1115000, 1175000, 114080.00, 132365.00, 118950.00),
('47', 1210000, 1175000, 1235000, 120032.00, 139271.00, 118950.00),
('48', 1270000, 1235000, 1295000, 125984.00, 146177.00, 118950.00),
('49', 1330000, 1295000, 1355000, 131936.00, 153083.00, 118950.00),
('50', 1390000, 1355000, 999999999, 137888.00, 159989.00, 118950.00);

-- 创建触发器函数，用于自动更新 updated_at 字段
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';

-- 创建触发器
CREATE TRIGGER update_premium_bracket_updated_at
    BEFORE UPDATE ON premium_bracket
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();

